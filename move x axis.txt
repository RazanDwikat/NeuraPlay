

#define STEP_PIN 4
#define DIR_PIN 3
#define ENA_PIN 2
#define LIMIT_SWITCH_PIN1 5  // Limit switch الأول
#define LIMIT_SWITCH_PIN2 6  // Limit switch الثاني

bool currentDirection = LOW;
bool switch1PreviouslyPressed = false;
bool switch2PreviouslyPressed = false;


void setup() {
  pinMode(STEP_PIN, OUTPUT);
  pinMode(DIR_PIN, OUTPUT);
  pinMode(ENA_PIN, OUTPUT);
  pinMode(LIMIT_SWITCH_PIN1, INPUT_PULLUP);
  pinMode(LIMIT_SWITCH_PIN2, INPUT_PULLUP);

  digitalWrite(ENA_PIN, LOW);  // تشغيل الدرايفر
  digitalWrite(DIR_PIN, currentDirection);  // تعيين الاتجاه
}

void loop() {
  bool switch1Pressed = (digitalRead(LIMIT_SWITCH_PIN1) == LOW);  // تم الضغط على الأول؟
  bool switch2Pressed = (digitalRead(LIMIT_SWITCH_PIN2) == LOW);  // تم الضغط على الثاني؟

  if (switch1Pressed && !switch1PreviouslyPressed) {
    currentDirection = !currentDirection;
    digitalWrite(DIR_PIN, currentDirection);
    delay(200);  // لمنع الاهتزاز
  }

  if (switch2Pressed && !switch2PreviouslyPressed) {
    currentDirection = !currentDirection;
    digitalWrite(DIR_PIN, currentDirection);
    delay(200);  // لمنع الاهتزاز
  }

  // تحديث الحالة السابقة
  switch1PreviouslyPressed = switch1Pressed;
  switch2PreviouslyPressed = switch2Pressed;

  // توليد نبضات للموتور
  digitalWrite(STEP_PIN, HIGH);
  delayMicroseconds(50);
  digitalWrite(STEP_PIN, LOW);
  delayMicroseconds(50);

}
